---
title: "Lab 05 - Modeling the Intervention"
author: "Group 03"
date: "`r format(Sys.time(), '%B %d, %Y')`"
output:
  html_document:
    theme: flatly
    highlight: tango
    toc: true
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
``` 


# Library

```{r, message = F, warning = F}
library( here )
library( import )
library( tidyverse )
library( pander )
library( dplyr )
library( knitr )
library( stargazer )
library( scales )
```

# Load Functions

```{r}
import::here("S_TYPE",
             "d",
             "df",
             "d3",
             "PLOTS",
             "%>%",
             .from = here::here("labs/wk05/lab_05_source.R"), # here::here() points to the .R file where all these R objects are created
             .character_only = TRUE)

detach("package:import", unload = TRUE)
```

# Rodeo Data Set

```{r}
# Save data set to rodeo folder
saveRDS(d, here("data/rodeo/rodeo-data-rn.rds"))

# Load data set
readRDS(file = here("data/rodeo/rodeo-data-rn.rds"))
```

# Data Manifest

```{r}
ltdb.raw.2000s <- read.csv( here("data/raw/ltdb_std_2000_sample.csv") )
ltdb.raw.2000f <- read.csv( here("data/raw/ltdb_std_2000_fullcount.csv") )
ltdb.rodeo.2000 <- readRDS( file = here("data/rodeo/ltdb-2000.rds") )

ltdb.raw.2010s <- read.csv( here("data/raw/ltdb_std_2010_sample.csv") )
ltdb.raw.2010f <- read.csv( here("data/raw/ltdb_std_2010_fullcount.csv") )
ltdb.rodeo.2010 <- readRDS( file = here("data/rodeo/ltdb-2010.rds") )

complete.rodeo <- readRDS( file = here("data/rodeo/rodeo-data-rn.rds") )
```

```{r}
nrow( ltdb.raw.2000s ) # 72,693
nrow( ltdb.raw.2000f ) # 72,693
nrow( ltdb.rodeo.2000 ) # 72,693

nrow( ltdb.raw.2010s ) # 73,056
nrow( ltdb.raw.2010f ) # 74,002
nrow( ltdb.rodeo.2010 ) #74,022
```

# Explain why the number of rows is less



```{r}
nrow( complete.rodeo )
```

# Diff-In-Diff Model for NMTC Program

```{r, warning = F, results = 'asis'}
# set randomization seed
set.seed( 1234 )

m1.nmtc <- lm( y ~ p.prof + treat.nmtc + post + treat.nmtc*post, data = d3 )
m2.nmtc <- lm( y ~ pov.rate + treat.nmtc + post + treat.nmtc*post, data = d3 )
m3.nmtc <- lm( y ~ p.unemp + treat.nmtc + post + treat.nmtc*post, data = d3 )

# Display model results
stargazer( m1.nmtc, m2.nmtc, m3.nmtc, 
           type = S_TYPE, 
           column.labels = c("Model 1", "Model 2", "Model 3"),
           dep.var.labels = c("Median House Value"),
           covariate.labels = c("Percent Professionals",
                                "Poverty Rate",
                                "Percent Unemployment",
                                "Treatment - NMTC",
                                "Post-NMTC Time Period",
                                "Treatment - NMTC x Post"),
           digits = 2 )
```


# Diff-In-Diff Model for LIHTC Program

```{r, warning = F, results = 'asis'}

m1.lihtc <- lm( y ~ p.prof + treat.lihtc + post + treat.lihtc*post, data = d3 )
m2.lihtc <- lm( y ~ pov.rate + treat.lihtc + post + treat.lihtc*post, data = d3 )
m3.lihtc <- lm( y ~ p.unemp + treat.lihtc + post + treat.lihtc*post, data = d3 )

# Display model results
stargazer( m1.lihtc, m2.lihtc, m3.lihtc, 
           type = S_TYPE, 
           column.labels = c("Model 1", "Model 2", "Model 3"),
           dep.var.labels = c("Median House Value"),
           covariate.labels = c("Percent Professionals",
                                "Poverty Rate",
                                "Percent Unemployment",
                                "Treatment - LIHTC",
                                "Post-LIHTC Time Period",
                                "Treatment - LIHTC x Post"),
           digits = 2 )
```

# Reflection

How can we test the parallel lines assumption in this model? We know that growth rates change significantly between periods. The market for urban homes from 1990-2000 looks very different from the market in 2000 to 2010.


<br>
<br>

